<div class="col-lg-4 container-sm text-center">
  <form class="row g-2 justify-content-center" action='<%= lookup_repositories_path %>' method="get">
    <div class="col-auto">
      <label for="repo_name" class="visually-hidden">Repository URL</label>
      <input name='url' type="text" class="form-control" id="url" placeholder="URL: eg https://github.com/owner/repo" size="50">
    </div>
    <div class="col-auto">
      <button type="submit" class="btn btn-primary mb-3">Search</button>
    </div>
  </form>
</div>

<div class="container-sm">
  <h1 class='mb-3'>
    Recent Dependabot Pull Requests
  </h1>

  <% if @issues.any? %>
    <div class="row">
      <% @issues.each do |issue| %>
        <div class="col-12 mb-3">
          <div class="card">
            <div class="card-body">
              <div class="d-flex align-items-start">
                <div class="flex-grow-1">
                  <h5 class="card-title">
                    <%= link_to [issue.host, issue.repository, issue], class: "text-decoration-none" do %>
                      <%= octicon "git-pull-request", class: "text-success me-2" %>
                      <%= issue.title %>
                    <% end %>
                  </h5>
                  
                  <h6 class="card-subtitle mb-2 text-muted">
                    <%= link_to issue.repository.full_name, [issue.host, issue.repository], class: "text-decoration-none" %>
                    #<%= issue.number %>
                  </h6>
                  
                  <p class="card-text text-muted">
                    <small>
                      <span class="badge bg-<%= issue.state == 'open' ? 'success' : 'secondary' %> me-2">
                        <%= issue.state.capitalize %>
                      </span>
                      
                      <%= octicon "person", class: "me-1" %>
                      <%= issue.user %>
                      
                      <%= octicon "clock", class: "ms-3 me-1" %>
                      <%= time_ago_in_words(issue.created_at) %> ago
                      
                      <% if issue.comments_count > 0 %>
                        <%= octicon "comment", class: "ms-3 me-1" %>
                        <%= pluralize issue.comments_count, 'comment' %>
                      <% end %>
                      
                      <% if issue.merged_at %>
                        <%= octicon "git-merge", class: "text-success ms-3 me-1" %>
                        Merged
                      <% end %>
                      
                      <% if issue.labels.any? %>
                        <div class="mt-2">
                          <% issue.labels.each do |label| %>
                            <span class="badge bg-light text-dark me-1"><%= label %></span>
                          <% end %>
                        </div>
                      <% end %>
                    </small>
                  </p>
                </div>
                
                <div class="flex-shrink-0">
                  <img src="https://github.com/dependabot.png" class="rounded" height='40' width='40' alt="Dependabot">
                </div>
              </div>
            </div>
          </div>
        </div>
      <% end %>
    </div>
    
    <%== pagy_bootstrap_nav(@pagy) if @pagy.pages > 1 %>
  <% else %>
    <div class="alert alert-info" role="alert">
      <h4 class="alert-heading">No Dependabot Pull Requests Found</h4>
      <p>No recent Dependabot pull requests have been imported yet. Try running the GHArchive import task to populate data:</p>
      <hr>
      <p class="mb-0">
        <code>rake gharchive:test_import</code>
      </p>
    </div>
  <% end %>
</div>